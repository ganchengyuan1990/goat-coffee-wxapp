<!-- <canvas style="margin:20rpx auto; width: 200px; height: 200px;" canvas-id="myQrcode"></canvas> -->

<wxs src="../filter.wxs" module="filter"></wxs>

<view class="container">
    <block wx:if="{{dtype === 'order'}}">
        <view class="hd-wrap">

            <view class="tt" wx:if="{{detail.orderState == '31' && overtime}}">已取消</view>

            <view class="tt" wx:else>{{filter.getOrderState(detail.orderState)}}</view>


            <view class="order_no" wx:if="{{detail.orderState == '01' || detail.orderState == '02' || detail.orderState == '03'}}" style="display: flex; justify-content: center; flex-direction: column;">
                取货码 {{detail.varCode}}
                <view style="display: flex; justify-content: center;" wx:if="{{!detail.storeCoffeeMakerId}}">
                    <image style="width: 200px; height: 200px; margin-top: 30rpx;" src="{{qrcodeURL}}" />
                </view>
                <view class="coffee_maker" wx:if="{{detail.storeCoffeeMakerId}}">请通过自助咖啡机兑换饮品</view>

            </view>

            <view class="daojishi" wx:if="{{clockWord && !cancled}}">请在 <text class='clock_word'>{{clockWord}}</text> 内支付，过时订单将会取消</view>

            <view class="daojishi xxx" wx:if="{{detail.isComment}}">期待您下次光临</view>

            <view class="refund_detail" wx:if="{{detail.orderState == 42}}">{{detail.refundDealReason}}</view>
            <view class="refund_detail" wx:if="{{detail.orderState == 41}}">您的支付金额已退回到原支付账户中</view>
            <view class="refund_detail" wx:if="{{detail.orderState == 40}}">预计2至3个工作日内完成退款</view>



            <!-- <view class="refund_detail" wx:if="{{detail.orderState == 01}}">预计5分钟内接单，请耐心等待</view>
            <view class="refund_detail" wx:if="{{detail.orderState == 02}}">预计{{lineNumber}}取餐，请耐心等待。</view>
            <view class="refund_detail" wx:if="{{detail.orderState == 03}}">请在{{lineNumber}}前取餐。</view> -->
            
            <!-- <view wx:if="{{detail.orderState == '02' || detail.orderState == '03'}}" style="display: flex; justify-content: center;">
                <image style="width: 200px; height: 200px; margin-top: 40rpx;" src="{{qrcodeURL}}" />
            </view> -->

            <!-- <view class="font" wx:if="{{detail.orderState == '02' || detail.orderState == '03'}}">请出示二维码给店员</view> -->


            
            <!-- <view class="desc">感谢您光临麦隆咖啡YOUNG</view> -->
            <!-- <view class="time_delivery" wx:if="{{detail.orderState == '01' || detail.orderState == '02' || detail.orderState == '03'}}">预计将在<text style="color: rgba(218, 163, 127, 1);">{{waitTime}}</text>前可取餐</view> -->
            <!-- <view class="order_numer">NO.{{detail.varCode}}</view> -->
            <view wx:if="{{detail.orderState == '00'}}" style="display: flex; justify-content: center; margin-top: 50rpx; margin-bottom: 50rpx;">
                <!-- <view class="btn-buy to-pay" catchtap="goStore" wx:if="{{detail.orderState == '02'}}">再来一单</view> -->
                <view class="btn-buy to-pay go-cancel" catchtap="goCancel" wx:if="{{detail.orderState == '00'}}">取消订单</view>
                <view class="btn-buy to-pay" catchtap="goStore" wx:if="{{detail.orderState == '00'}}">立即支付</view>

                <!-- <view class="btn-buy to-pay invoice_button" catchtap="goInvice" wx:if="{{detail.orderState == '100' && !detail.billOrderID && detail.payAmount}}">开发票</view> -->


                <!-- <view class="btn-buy to-pay" catchtap="goVarcode" wx:if="{{filter.getOrderState(detail.orderState) !=1 && detail.orderState == '02' && detail.orderState != '03'}}">取餐码</view> -->
                <!-- <view class="btn-buy to-pay" catchtap="goComment" wx:if="{{detail.orderState == '100' && !detail.isComment}}">订单评价</view> -->
            </view>

            <view wx:else style="display: flex; justify-content: center; margin-bottom: 50rpx;">
                <view class="btn-buy to-pay go-cancel" catchtap="goCancel" wx:if="{{detail.orderState == '00'}}">取消订单</view>
                <view class="btn-buy to-pay" catchtap="goStore" wx:if="{{detail.orderState == '00'}}">立即支付</view>
            </view>

            <view class="order-title border-line1">
                <text class="name">{{detail.storeName}}<text wx:if="{{detail.storeCoffeeMakerId}}">（编号{{detail.storeCoffeeMakerId}}）</text></text>
                <image style='position: relative; top: 8rpx; width: 30rpx; height: 37rpx; margin-right: 9rpx;' src="../../../images/order_loc.png" />
            </view>
        </view>
        <!-- <view style="position: relative;margin: 10rpx 30rpx;" bindtap="goRedPack">
            <image src="http://img.goatup.net/banner/6redbao.png" style="width: 100%; height: 350rpx" />
        </view> -->
        <view class="panel order-box">
            <view class="border-line">
                <view class="panel-hd">
                    <view class="tt">{{item.storeName}}<text wx:if="{{item.order.orderType === 1}}">(NO.{{item.varCode}})</text></view>
                    <!-- <view class="{{item.order.orderState === '00' ? 'active':''}}">{{filter.getOrderState(item.order.orderState)}}</view> -->
                </view>
                <view class="order-item" wx:for="{{detail.detailList}}" wx:key="{{index}}">
                    <view class="pro_icon">
                        <image src="{{item.productIcon}}" />
                    </view>
                    <view class="order_numer_detail">
                        <view class="first_line">
                            <view class="product_name_line">
                                <view class="{{item.isGift ? 'product_name' : 'product_name_sss'}}">{{item.productName}}</view>
                                <view wx:if="{{item.isGift}}" class="zengpin">赠品</view>
                                <!-- <text class="zengpin">赠品</text> -->
                            </view>
                            <view class="price">
                                <text style="color: #99918D; margin-right: 40rpx; display: flex;height: 92rpx;align-items: center;">x{{item.number}}</text>
                                <view style="display: flex; flex-direction: column; font-weight: 500; text-align: right;justify-content: center;height: 90rpx;">
                                    <text class="{{item.isGift ? 'price-del' : ''}}">￥{{item.memberUnitPrice}}</text>
                                    <text class="price-del" wx:if="{{item.skuPrice && item.memberUnitPrice !== item.skuPrice}}">￥{{item.skuPrice}}</text>
                                </view>

                            </view>
                        </view>
                        <view class="time">
                            <text>{{item.spec}}</text>
                        </view>
                    </view>
                </view>

                <view class="order-item" wx:for="{{guaerItems}}" wx:key="{{index}}">
                    <view class="pro_icon">
                        <image src="{{item.productIcon}}" />
                    </view>
                    <view class="order_numer_detail">
                        <view class="first_line">
                            <text class="product_name">{{item.productName}}<view class="zengpin">赠品</view></text>
                            <text class="price">
                                <text style="color: #99918D; margin-right: 40rpx;">x{{item.number}}</text>
                                <text>￥{{item.skuPrice}}</text>
                            </text>
                        </view>
                        <view class="time">
                            <text>{{item.spec}}</text>
                        </view>
                    </view>
                </view>
            </view>
            <view class="transport-item llll" wx:if="{{item.order.orderType === 1}}">
                <view class="l">
                    <text class="name">配送费</text>
                </view>
                <view class="r">
                    <text class="txt">￥{{detail.deliverFee}}</text>
                </view>
            </view>
            <view style="height:1rpx; background: rgba(0,0,0,.1)"></view>
            <view class="transport-item llll" wx:if="{{detail.levelAmount}}">
                <view class="l">
                    <text class="name">会员优惠</text>
                </view>
                <view class="r">
                    <text class="txt">- ￥ {{detail.levelAmount}}</text>
                    <!-- <image class="arrow" /> -->
                    <!-- <image class="txt" src="../../../images/arrow.png"/> -->
                </view>
            </view>
            <view class="transport-item llll" wx:if="{{detail.ownCupSubsidy}}">
                <view class="l">
                    <text class="name">自带杯</text>
                </view>
                <view class="r">
                    <text class="txt">- ￥ {{detail.ownCupSubsidy}}</text>
                    <!-- <image class="arrow" /> -->
                    <!-- <image class="txt" src="../../../images/arrow.png"/> -->
                </view>
            </view>
            
            <view class="transport-item llll" wx:for="{{otherLalaName}}" wx:for-item="item" wx:key="{{item.name}}">
                <view class="l">
                    <text class="name">{{item.name}}</text>
                </view>
                <view class="r">
                    <text class="txt" wx:if="{{item.money > 0}}">- ￥ {{item.money}}</text>
                    <text class="txt" wx:else>￥ {{item.money}}</text>
                    <!-- <image class="arrow" src="../../../images/arrow.png" /> -->
                    <!-- <image class="txt" src="../../../images/arrow.png"/> -->
                </view>
            </view>
            <view style="height:1rpx; background: rgba(0,0,0,.1)"></view>
            <view class="special-item">
                <view class="l">
                    <!-- <text class="name">共{{filter.getSum(detail.detailList)}}件商品</text> -->
                    <text class="name">合计</text>
                    
                </view>
                <view class="r">实付<text class="price-del" wx:if="{{detail.totalPrice !== detail.payAmount}}">￥{{detail.totalPrice}}</text>￥{{detail.payAmount}}</view>
            </view>
        </view>
        <view class="panel">
            <view class="transport-item second" wx:if="{{detail.deliveryTimeStr}}">
                <view class="l">
                    <text class="name">预计配送时间</text>
                </view>
                <view class="r">
                    <text class="addr">{{detail.deliveryTimeStr}}</text>
                </view>
            </view>
            <view class="transport-item second">
                <view class="l">
                    <text class="name">订单编号</text>
                </view>
                <view class="r_ds rrr">
                    <text class="addr">{{detail.orderNo}}</text>
                </view>
            </view>
            <view class="transport-item second" wx:if="{{detail.riderTel}}">
                <view class="l">
                    <text class="name">配送员电话</text>
                </view>
                <view class="r">
                    <text class="addr">{{detail.riderTel}}</text>
                </view>
            </view>
            <view class="transport-item second">
                <view class="l">
                    <text class="name">下单时间</text>
                </view>
                <view class="r_ds rrr">
                    <text class="addr">{{detail.CreateTime}}</text>
                </view>
            </view>
            <!-- <view class="transport-item second">
                <view class="l">
                    <text class="name">吸管需求</text>
                </view>
                <view class="r">
                    <text class="addr">{{detail.xiguan}}</text>
                </view>
            </view> -->
            <view class="transport-item second {{detail.remarkJson.other ? 'higher' : ''}}" wx:if="{{!detail.storeCoffeeMakerId}}">
                <view class="l">
                    <text class="name">备注特殊要求</text>
                </view>
                <view class="r_ds {{detail.remarkJson.other ? 'zhoujielun' : 'linjunjie'}}">
                    <text class="addr">{{detail.remarkJson.other || '不需要纸巾、不需要糖包'}}</text>
                </view>
            </view>
        </view>
    </block>
    <block wx:if="{{dtype === 'group'}}">
        <view class="hd-wrap">
            <view class="tt">{{filter.getGroupState(detail.payState)}}</view>
            <view class="desc">感谢您的光临</view>
        </view>
        <view class="panel order-box">
            <view class="border-line">
                <view class="order-title border-line">
                    <text class="name">团购订单{{detail.groupOrderNo}}</text>
                    <text>{{detail.CreateTime}}</text>
                </view>
                <view class="order-item">
                    <view class="l">
                        <text class="name">{{detail.groupName}}</text>
                        <!-- <text class="format">{{item.spec}}</text> -->
                    </view>
                    <view class="center">
                        <text class="txt"></text>
                    </view>
                    <view class="r">
                        <text class="txt">￥{{detail.payAmount}}</text>
                    </view>
                </view>
            </view>
            <view class="special-item">
                <view class="l">
                    <text class="name">共1件商品</text>
                </view>
                <view class="r">实付<text class="price-del" wx:if="{{detail.totalAmount !== detail.payAmount}}">￥{{detail.totalAmount}}</text>￥{{detail.payAmount}}</view>
            </view>
        </view>
        <view class="panel tip-box">
            <view class="name">温馨提示</view>
            <view class="desc">您拼团成功后的兑换券已存入咖啡库，您可以直接在购买咖啡时使用～～</view>
        </view>
    </block>

    <view class="act-wrap" wx:if="{{showDialog}}">
        <view class="mask {{showDialog ? 'active':''}}"></view>
        <view class="cnt">
            <view class="btn-close" bind:tap="hideActWrap"></view>
            <image src="{{actImage}}" data-src="{{actImage}}" mode="widthFix" bind:tap="previewImage"></image>
            <view class="get_button" bindtap="getGifts">升级</view>
        </view>
    </view>

    <toast wx:if="{{errorToastShown}}" is-show="{{errorToastShown}}" title="{{errorInfo}}" disappear-sec="3"></toast>

</view>


<!-- <custom-tab-bar /> -->